<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Listening — IELTS Prep</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <h1 class="logo">IELTS Prep</h1>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="practice.html">Practice</a>
        <a href="resources.html">Resources</a>
      </nav>
    </div>
  </header>
  <main class="container">
    <h2>Listening — Tips & Practice</h2>
    <p>Work on prediction, note-taking and identifying paraphrase. Try short timed exercises (20–30 minutes).</p>

    <section class="exercise-section teal">
      <h3>Exercise — Short listening (browser voice)</h3>
      <p>Play the audio (the browser will read the short announcement). Try to listen twice without reading the transcript, then answer the questions below.</p>

      <div class="audio-player" style="margin:12px 0; display:flex; gap:8px; align-items:center;flex-wrap:wrap;">
        <button id="playBtn" class="btn">Play</button>
        <button id="pauseBtn" class="btn">Pause</button>
        <button id="replayBtn" class="btn">Replay</button>
        <label style="font-size:0.9rem;color:var(--muted);margin-left:6px;">
          Load local audio:
          <input id="fileInput" type="file" accept="audio/*" style="margin-left:8px;">
        </label>
        <small style="display:block;margin-top:6px;color:var(--muted);width:100%;">Plays `audio/listening1.mp3` if present; you can also load a local MP3, or paste a transcript below.</small>
      </div>
      <audio id="audioEl" controls style="display:none;margin-top:8px;max-width:100%;">
        <source src="audio/listening1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>

      <div class="tts-controls" style="margin:10px 0;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
        <label style="font-size:0.9rem;color:var(--muted);">Voice:
          <select id="voiceSelect" style="margin-left:6px;padding:6px;"></select>
        </label>
        <label style="font-size:0.9rem;color:var(--muted);">Rate:
          <input id="rateSlider" type="range" min="0.8" max="1.2" step="0.05" value="1.0" style="margin-left:6px;">
        </label>
        <label style="font-size:0.9rem;color:var(--muted);">Pitch:
          <input id="pitchSlider" type="range" min="0.8" max="1.2" step="0.05" value="1.0" style="margin-left:6px;">
        </label>
        <label style="font-size:0.9rem;color:var(--muted);">
          <input id="naturalizeChk" type="checkbox" style="margin-left:6px;"> Naturalize (short pauses)
        </label>
      </div>

      <h4>Announcement (listen)</h4>
      <p id="listeningText" style="display:none;">Good morning. This is a brief transport announcement. We changed the bus timetable last month. Buses now run every fifteen minutes during the morning rush, and there is a new direct route to the university. Fare prices remain the same. For more information, check the transport website.</p>

      <div style="margin-top:10px;">
        <label style="font-weight:600;">Transcript / Paste your test transcript here (not saved to disk):</label>
        <textarea id="transcriptEditor" rows="6" style="width:100%;margin-top:6px;padding:8px;font-size:0.95rem;">Good morning. This is a brief transport announcement. We changed the bus timetable last month. Buses now run every fifteen minutes during the morning rush, and there is a new direct route to the university. Fare prices remain the same. For more information, check the transport website.</textarea>
        <div style="margin-top:6px;display:flex;gap:8px;align-items:center;">
          <button id="applyTranscript" class="btn">Use transcript</button>
          <small style="color:var(--muted);">Paste your real IELTS listening transcript here and click "Use transcript". This will only update the page in your browser.</small>
        </div>
      </div>

      <ol>
        <li>What change was made to the bus service?
          <ul>
            <li>A. The fares were reduced</li>
            <li>B. Buses run more often during the morning</li>
            <li>C. The bus company stopped the direct route</li>
            <li>D. New ticket types were introduced</li>
          </ul>
        </li>
        <li>Where is the new direct route to? (one short phrase)</li>
        <li>How often do buses run during the morning rush? (short answer)</li>
      </ol>

      <details>
        <summary>✓ Show answers</summary>
        <ol>
          <li><strong>B.</strong> Buses now run more often during the morning (every 15 minutes).</li>
          <li>The university.</li>
          <li>Every fifteen minutes.</li>
        </ol>
      </details>

      <details>
        <summary>✓ Show transcript</summary>
        <p>Good morning. This is a brief transport announcement. We changed the bus timetable last month. Buses now run every fifteen minutes during the morning rush, and there is a new direct route to the university. Fare prices remain the same. For more information, check the transport website.</p>
      </details>

      <h4>Listening strategy</h4>
      <p>Listen for keywords (time, place, route). If you miss something, try listening again and focus on the verbs and numbers.</p>

      <hr style="margin:20px 0;border:none;border-top:1px solid var(--border);">

      <h3>Exercise 2 — Fill in the blanks (note-taking)</h3>
      <p id="listeningText2" style="display:none;">Hello, this is a message for Mr. Johnson from the City Dental Clinic. We are calling to confirm your appointment on Wednesday at two o'clock in the afternoon. Please bring your insurance card and a form of identification. If you need to reschedule, please call us before Monday. Our office is located at 145 Oak Street, third floor, suite three-oh-five.</p>
      <p><strong>Dialogue (listen to the voicemail):</strong> You will hear a voicemail message. Fill in the missing information.</p>
      <ol>
        <li>Appointment day: __________</li>
        <li>Appointment time: __________</li>
        <li>Bring: Insurance card and __________</li>
        <li>Reschedule deadline: __________</li>
        <li>Office location: __________ Street, suite 305</li>
      </ol>
      <details>
        <summary>✓ Show answers</summary>
        <ol>
          <li>Wednesday</li>
          <li>Two o'clock (in the afternoon) / 2 PM</li>
          <li>A form of identification / identification</li>
          <li>Before Monday / Monday</li>
          <li>145 Oak</li>
        </ol>
      </details>
      <details>
        <summary>✓ Show transcript</summary>
        <p>Hello, this is a message for Mr. Johnson from the City Dental Clinic. We are calling to confirm your appointment on Wednesday at two o'clock in the afternoon. Please bring your insurance card and a form of identification. If you need to reschedule, please call us before Monday. Our office is located at 145 Oak Street, third floor, suite three-oh-five.</p>
      </details>

      <hr style="margin:20px 0;border:none;border-top:1px solid var(--border);">

      <h3>Exercise 3 — Multiple choice (conversation)</h3>
      <p id="listeningText3" style="display:none;">A: Hi Sarah, I am thinking about taking a cooking class. Do you have any suggestions? B: Oh yes, I took a class last year at the community center. The instructor was fantastic. A: Great! What kind of food did you learn? B: We focused on Italian cuisine, especially pasta and risotto. The classes ran on Tuesday and Thursday evenings for eight weeks. A: That sounds perfect! How much did it cost? B: It was one hundred and fifty dollars for the whole course, which I thought was very reasonable.</p>
      <p><strong>Dialogue (listen to the conversation):</strong> Two friends are discussing a cooking class.</p>
      <ol>
        <li>Where did Sarah take the cooking class?
          <ul>
            <li>A. At a private chef's kitchen</li>
            <li>B. At the community center</li>
            <li>C. At a cooking school downtown</li>
            <li>D. At a restaurant</li>
          </ul>
        </li>
        <li>What type of cuisine did they learn?
          <ul>
            <li>A. French</li>
            <li>B. Asian</li>
            <li>C. Italian</li>
            <li>D. Spanish</li>
          </ul>
        </li>
        <li>How many weeks did the course last?
          <ul>
            <li>A. Four weeks</li>
            <li>B. Six weeks</li>
            <li>C. Eight weeks</li>
            <li>D. Ten weeks</li>
          </ul>
        </li>
      </ol>
      <details>
        <summary>✓ Show answers</summary>
        <ol>
          <li><strong>B.</strong> At the community center</li>
          <li><strong>C.</strong> Italian</li>
          <li><strong>C.</strong> Eight weeks</li>
        </ol>
      </details>
      <details>
        <summary>✓ Show transcript</summary>
        <p>A: Hi Sarah, I am thinking about taking a cooking class. Do you have any suggestions? B: Oh yes, I took a class last year at the community center. The instructor was fantastic. A: Great! What kind of food did you learn? B: We focused on Italian cuisine, especially pasta and risotto. The classes ran on Tuesday and Thursday evenings for eight weeks. A: That sounds perfect! How much did it cost? B: It was one hundred and fifty dollars for the whole course, which I thought was very reasonable.</p>
      </details>

      <hr style="margin:20px 0;border:none;border-top:1px solid var(--border);">

      <h3>Exercise 4 — Matching (information details)</h3>
      <p id="listeningText4" style="display:none;">Welcome to the Summer Camp information session. This camp offers four different programs. First, we have the Art and Craft program, which meets in the Studio Building from nine to eleven in the morning. The Sports and Fitness program is held at the outdoor gym, from two to four in the afternoon. Our Technology and Coding workshop takes place in the Computer Lab, from one to three p.m. Finally, the Drama and Performance program is in the Theater from three-thirty to five-thirty p.m.</p>
      <p><strong>Listen to the information about summer camp programs and match each program to its location and time.</strong></p>
      <table style="width:100%;margin-top:8px;border-collapse:collapse;">
        <tr style="border-bottom:1px solid var(--border);">
          <th style="text-align:left;padding:8px;font-weight:600;">Program</th>
          <th style="text-align:left;padding:8px;font-weight:600;">Location</th>
          <th style="text-align:left;padding:8px;font-weight:600;">Time</th>
        </tr>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:8px;">Art and Craft</td>
          <td style="padding:8px;">__________</td>
          <td style="padding:8px;">__________</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:8px;">Sports and Fitness</td>
          <td style="padding:8px;">__________</td>
          <td style="padding:8px;">__________</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:8px;">Technology and Coding</td>
          <td style="padding:8px;">__________</td>
          <td style="padding:8px;">__________</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:8px;">Drama and Performance</td>
          <td style="padding:8px;">__________</td>
          <td style="padding:8px;">__________</td>
        </tr>
      </table>
      <details>
        <summary>✓ Show answers</summary>
        <table style="width:100%;margin-top:8px;border-collapse:collapse;">
          <tr style="border-bottom:1px solid var(--border);">
            <th style="text-align:left;padding:8px;font-weight:600;">Program</th>
            <th style="text-align:left;padding:8px;font-weight:600;">Location</th>
            <th style="text-align:left;padding:8px;font-weight:600;">Time</th>
          </tr>
          <tr style="border-bottom:1px solid var(--border);">
            <td style="padding:8px;">Art and Craft</td>
            <td style="padding:8px;">Studio Building</td>
            <td style="padding:8px;">9:00 AM – 11:00 AM</td>
          </tr>
          <tr style="border-bottom:1px solid var(--border);">
            <td style="padding:8px;">Sports and Fitness</td>
            <td style="padding:8px;">Outdoor Gym</td>
            <td style="padding:8px;">2:00 PM – 4:00 PM</td>
          </tr>
          <tr style="border-bottom:1px solid var(--border);">
            <td style="padding:8px;">Technology and Coding</td>
            <td style="padding:8px;">Computer Lab</td>
            <td style="padding:8px;">1:00 PM – 3:00 PM</td>
          </tr>
          <tr style="border-bottom:1px solid var(--border);">
            <td style="padding:8px;">Drama and Performance</td>
            <td style="padding:8px;">Theater</td>
            <td style="padding:8px;">3:30 PM – 5:30 PM</td>
          </tr>
        </table>
      </details>
      <details>
        <summary>✓ Show transcript</summary>
        <p>Welcome to the Summer Camp information session. This camp offers four different programs. First, we have the Art and Craft program, which meets in the Studio Building from nine to eleven in the morning. The Sports and Fitness program is held at the outdoor gym, from two to four in the afternoon. Our Technology and Coding workshop takes place in the Computer Lab, from one to three p.m. Finally, the Drama and Performance program is in the Theater from three-thirty to five-thirty p.m.</p>
      </details>

      <script>
        (function(){
          var play = document.getElementById('playBtn');
          var pause = document.getElementById('pauseBtn');
          var replay = document.getElementById('replayBtn');
          var fileInput = document.getElementById('fileInput');
          var applyTranscriptBtn = document.getElementById('applyTranscript');
          var transcriptEditor = document.getElementById('transcriptEditor');
          var text = document.getElementById('listeningText').textContent.trim();
          var audioEl = document.getElementById('audioEl');
          var useAudioFile = false;
          var localObjectURL = null;

          var voiceSelect = document.getElementById('voiceSelect');
          var rateSlider = document.getElementById('rateSlider');
          var pitchSlider = document.getElementById('pitchSlider');
          var naturalizeChk = document.getElementById('naturalizeChk');

          var currentQueue = null;
          var currentIndex = 0;

          function makeUtterance(chunk){
            var u = new SpeechSynthesisUtterance(chunk);
            u.rate = parseFloat(rateSlider.value || 1.0);
            u.pitch = parseFloat(pitchSlider.value || 1.0);
            u.lang = 'en-GB';
            var selected = voiceSelect.value;
            if(selected && speechSynthesis.getVoices){
              var v = speechSynthesis.getVoices().find(function(vi){ return vi.name === selected || vi.voiceURI === selected; });
              if(v) u.voice = v;
            }
            return u;
          }

          function populateVoices(){
            if(!('speechSynthesis' in window)) return;
            var voices = speechSynthesis.getVoices() || [];
            voiceSelect.innerHTML = '';
            voices.forEach(function(v){
              var opt = document.createElement('option');
              opt.value = v.name || v.voiceURI;
              opt.textContent = v.name + ' (' + (v.lang || '') + ')';
              voiceSelect.appendChild(opt);
            });
            // prefer en-GB or en-US
            var prefer = voices.find(function(v){ return /en-?gb/i.test(v.lang); }) || voices.find(function(v){ return /en-?us/i.test(v.lang); });
            if(prefer) voiceSelect.value = prefer.name;
          }

          if('speechSynthesis' in window){
            populateVoices();
            window.speechSynthesis.onvoiceschanged = populateVoices;
          }

          // Check for an actual audio file (HEAD request). If present, show audio player and prefer it.
          (function checkAudioFile(){
            if(!window.fetch) return; // can't check
            fetch('audio/listening1.mp3', { method: 'HEAD' }).then(function(res){
              if(res.ok){
                useAudioFile = true;
                if(audioEl){
                  audioEl.style.display = 'block';
                }
              }
            }).catch(function(){
              // ignore; keep TTS fallback
            });
          })();

          // load local file via file input and use it (object URL)
          if(fileInput){
            fileInput.addEventListener('change', function(e){
              var f = (e.target.files && e.target.files[0]);
              if(!f) return;
              if(localObjectURL){ URL.revokeObjectURL(localObjectURL); localObjectURL = null; }
              localObjectURL = URL.createObjectURL(f);
              if(audioEl){
                audioEl.src = localObjectURL;
                audioEl.style.display = 'block';
              }
              useAudioFile = true;
            });
          }

          // apply transcript from the editor (in-browser only)
          if(applyTranscriptBtn){
            applyTranscriptBtn.addEventListener('click', function(){
              var t = transcriptEditor.value || '';
              t = t.replace(/\r\n?/g,'\n');
              document.getElementById('listeningText').textContent = t;
              text = t;
              alert('Transcript updated on page (in-browser only).');
            });
          }

          function speakSentences(sentences){
            if(!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            currentQueue = sentences.slice();
            currentIndex = 0;
            speakNext();
          }

          function speakNext(){
            if(!currentQueue) return;
            if(currentIndex >= currentQueue.length) return;
            var chunk = currentQueue[currentIndex];
            var u = makeUtterance(chunk);
            u.onend = function(){
              currentIndex++;
              // short natural pause
              setTimeout(speakNext, 180 + Math.random()*120);
            };
            window.speechSynthesis.speak(u);
          }

          play.addEventListener('click', function(){
            if(useAudioFile && audioEl){
              audioEl.play().catch(function(){
                alert('Could not play the audio file. Check that `audio/listening1.mp3` exists.');
              });
              return;
            }

            if(!('speechSynthesis' in window)){
              alert('No speech synthesis and no audio file available. Please add `audio/listening1.mp3` to the `audio/` folder.');
              return;
            }

            // If naturalize is enabled, split text into sentences and queue them
            if(naturalizeChk.checked){
              var raw = text.replace(/\s+/g,' ').trim();
              var sentences = raw.match(/[^.!?]+[.!?]?/g) || [raw];
              sentences = sentences.map(function(s){ return s.trim(); }).filter(Boolean);
              speakSentences(sentences);
              return;
            }

            // normal single-utterance speak
            var u = makeUtterance(text);
            if(window.speechSynthesis.paused) window.speechSynthesis.resume();
            else window.speechSynthesis.speak(u);
          });

          pause.addEventListener('click', function(){
            if(useAudioFile && audioEl){
              audioEl.pause();
              return;
            }
            if('speechSynthesis' in window) window.speechSynthesis.pause();
          });

          replay.addEventListener('click', function(){
            if(useAudioFile && audioEl){
              try{ audioEl.currentTime = 0; audioEl.play(); }catch(e){
                audioEl.play().catch(function(){/* ignore */});
              }
              return;
            }
            if(!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            if(naturalizeChk.checked){
              var raw = text.replace(/\s+/g,' ').trim();
              var sentences = raw.match(/[^.!?]+[.!?]?/g) || [raw];
              sentences = sentences.map(function(s){ return s.trim(); }).filter(Boolean);
              speakSentences(sentences);
            } else {
              var u = makeUtterance(text);
              window.speechSynthesis.speak(u);
            }
          });

          // stop TTS and audio on navigation away
          window.addEventListener('beforeunload', function(){
            if('speechSynthesis' in window) window.speechSynthesis.cancel();
            if(audioEl) try{ audioEl.pause(); }catch(e){}
          });
        })();
      </script>
    </section>
    </main>
  <footer class="site-footer container">© 2025 IELTS Prep</footer>
  <script src="app.js"></script>
</body>
</html>
